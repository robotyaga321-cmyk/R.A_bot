<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ü–µ—Å–æ—á–Ω–∏—Ü–∞: –ü—É—Ç—å –û–¥–∏–Ω–∞</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: sans-serif; overflow: hidden; }
        #ui-top { position: absolute; top: 10px; left: 10px; display: flex; gap: 10px; z-index: 10; }
        .stat-box { background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 8px; border: 1px solid #444; }
        
        #game-container { position: relative; width: 100vw; height: 100vh; }
        canvas { display: block; }
        
        /* –ú–∏–Ω–∏-–∫–∞—Ä—Ç–∞ */
        #minimap { 
            position: absolute; top: 10px; right: 10px; 
            width: 100px; height: 100px; 
            background: rgba(0,0,0,0.8); border: 2px solid #555; border-radius: 5px; 
        }

        /* –î–∂–æ–π—Å—Ç–∏–∫ */
        #joystick-container {
            position: absolute; bottom: 50px; left: 50px;
            width: 120px; height: 120px; background: rgba(255,255,255,0.1);
            border-radius: 60px; touch-action: none;
        }
        #joystick-stick {
            position: absolute; top: 35px; left: 35px;
            width: 50px; height: 50px; background: rgba(255,255,255,0.5);
            border-radius: 25px;
        }
    </style>
</head>
<body>

<div id="ui-top">
    <div class="stat-box">‚ù§Ô∏è HP: <span id="hp-val">100</span></div>
    <div class="stat-box">üí∞ –ó–æ–ª–æ—Ç–æ: <span id="gold-val">0</span></div>
</div>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <canvas id="minimap"></canvas>
    
    <div id="joystick-container">
        <div id="joystick-stick"></div>
    </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mCanvas = document.getElementById('minimap');
const mCtx = mCanvas.getContext('2d');

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
mCanvas.width = 100;
mCanvas.height = 100;

// –ò–≥—Ä–æ–∫ –∏ –ú–∏—Ä
let player = { x: 500, y: 500, hp: 100, gold: 0, size: 10 };
const worldSize = 2000; // –†–∞–∑–º–µ—Ä –≤—Å–µ–π –∫–∞—Ä—Ç—ã

// –°—É—â–µ—Å—Ç–≤–∞ (NPC –∏ –≤—Ä–∞–≥–∏)
let entities = [
    { x: 550, y: 520, type: 'villager', color: 'yellow' },
    { x: 700, y: 600, type: 'goblin', color: '#2ed573', hp: 30 },
    { x: 1200, y: 1200, type: 'boss', color: 'red', hp: 200, size: 25 }
];

// –î–∂–æ–π—Å—Ç–∏–∫ –ª–æ–≥–∏–∫–∞
let moveX = 0, moveY = 0;
const stick = document.getElementById('joystick-stick');
const joyContainer = document.getElementById('joystick-container');

joyContainer.addEventListener('touchstart', handleStart);
joyContainer.addEventListener('touchmove', handleMove);
joyContainer.addEventListener('touchend', handleEnd);

function handleStart(e) { handleMove(e); }
function handleEnd() { 
    stick.style.transform = `translate(0px, 0px)`; 
    moveX = 0; moveY = 0; 
}

function handleMove(e) {
    const rect = joyContainer.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    const touch = e.touches[0];
    
    let dx = touch.clientX - centerX;
    let dy = touch.clientY - centerY;
    const dist = Math.sqrt(dx*dx + dy*dy);
    const maxDist = 40;

    if (dist > maxDist) {
        dx *= maxDist / dist;
        dy *= maxDist / dist;
    }

    stick.style.transform = `translate(${dx}px, ${dy}px)`;
    moveX = dx / 15;
    moveY = dy / 15;
}

// –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –∏–≥—Ä—ã
function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

function update() {
    // –î–≤–∏–∂–µ–Ω–∏–µ
    player.x += moveX;
    player.y += moveY;

    // –ì—Ä–∞–Ω–∏—Ü—ã –º–∏—Ä–∞
    player.x = Math.max(0, Math.min(worldSize, player.x));
    player.y = Math.max(0, Math.min(worldSize, player.y));

    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–æ—è (–µ—Å–ª–∏ –ø–æ–¥–æ—à–ª–∏ –≤–ø–ª–æ—Ç–Ω—É—é –∫ –≤—Ä–∞–≥—É)
    entities.forEach(en => {
        let dist = Math.sqrt((player.x - en.x)**2 + (player.y - en.y)**2);
        if (dist < 20 && en.type !== 'villager') {
            en.hp -= 0.5; // –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω
            if (en.hp <= 0) {
                player.gold += 10;
                document.getElementById('gold-val').innerText = player.gold;
                en.x = -1000; // –£–±–∏—Ä–∞–µ–º —É–±–∏—Ç–æ–≥–æ
            }
        }
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞–º–µ—Ä—É –Ω–∞ –∏–≥—Ä–æ–∫–µ
    const camX = canvas.width / 2 - player.x;
    const camY = canvas.height / 2 - player.y;

    // –†–∏—Å—É–µ–º –±–∏–æ–º—ã (—Ñ–æ–Ω)
    ctx.fillStyle = player.y < 1000 ? "#2d4a22" : "#1a2a3a"; // –õ–µ—Å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –ª–µ–¥
    ctx.fillRect(camX, camY, worldSize, worldSize);

    // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
    ctx.strokeStyle = "rgba(255,255,255,0.05)";
    for(let i=0; i<worldSize; i+=100) {
        ctx.beginPath(); ctx.moveTo(i+camX, camY); ctx.lineTo(i+camX, worldSize+camY); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(camX, i+camY); ctx.lineTo(worldSize+camX, i+camY); ctx.stroke();
    }

    // –†–∏—Å—É–µ–º NPC/–í—Ä–∞–≥–æ–≤
    entities.forEach(en => {
        ctx.fillStyle = en.color;
        ctx.beginPath();
        ctx.arc(en.x + camX, en.y + camY, en.size || 10, 0, Math.PI*2);
        ctx.fill();
    });

    // –†–∏—Å—É–µ–º –ò–≥—Ä–æ–∫–∞ (–°–∏–Ω—è—è —Ç–æ—á–∫–∞)
    ctx.fillStyle = "#3498db";
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, player.size, 0, Math.PI*2);
    ctx.fill();

    // –ú–∏–Ω–∏-–∫–∞—Ä—Ç–∞
    mCtx.fillStyle = "black";
    mCtx.fillRect(0,0,100,100);
    mCtx.fillStyle = "blue";
    mCtx.fillRect((player.x / worldSize) * 100, (player.y / worldSize) * 100, 4, 4);
}

gameLoop();
</script>
</body>
</html>
